{% extends 'base.html' %}
{% block title %}Create an ad{% endblock %}
{% block header %} 
    <h1>Create new ad</h1>
{% endblock %}

{% block main_content %}
	<form id='create-ad' method='post' class='form-horizontal'>
		<fieldset>
			{% csrf_token %}
			<table class='table table-striped table-bordered table-hover '>
				{{ formset }}
                <tr>
                    <th><label for="id_contact_city">Contact City:</label></th>
                    <td>
                        <select name='id_contact_country' id='id_contact_country'></select>
                        <select name='id_contact_province' id='id_contact_province'></select>
                        <select name='id_contact_city' id='id_contact_city'></select>
                    </td>
                </tr>
			</table>
            <p><input type='submit' class='btn btn-primary ' value='Save'/></p>
		</fieldset>
	</form>
{% endblock %}

{% block custom_script %}
<script type='text/javascript'>
$(function() {
	var fields = {};

	fields.country = $('#id_contact_country');
	fields.province = $('#id_contact_province');
	fields.city = $('#id_contact_city');

	fields.country.requestValue = '{{ contact_location.country }}';
	fields.province.requestValue = '{{ contact_location.province }}';
	fields.city.requestValue = '{{ contact_location.city }}';

	fields.country.ready(function() {
		jQuery.getJSON('/api/json/location/countries/', function(data) {
			fields.country.html('');
            fields.country.append($("<option />"));
			$.each(data, function(i, e) {
				var id = e.pk;
				var name = e.fields.name;
				fields.country.append($("<option />").val(id).text(name));
			});
		});
	});

	fields.country.on('change', function() {
		var countryId = $(this).val() ? $(this).val() : 0;
		jQuery.getJSON('/api/json/location/provinces/' + countryId, function(data) {
			fields.province.html('');
			fields.city.html('');
			$.each(data, function(i, e) {
				var id = e.pk;
				var name = e.fields.name;
				fields.province.append($("<option />").val(id).text(name));
			});
		});
	});

	fields.province.on('change', function() {
		var provinceId = $(this).val();
		jQuery.getJSON('/api/json/location/cities/' + provinceId, function(data) {
			fields.city.html('');
			$.each(data, function(i, e) {
				var id = e.pk;
				var name = e.fields.name;
				fields.city.append($("<option />").val(id).text(name));
			});
		});
	});

});
</script>
{% endblock %}